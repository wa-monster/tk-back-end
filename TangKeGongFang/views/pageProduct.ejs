<%- include header/nav.ejs %>

<style>
    li{
        list-style-type: none;
    }
    #addbtn{
        display: block;
        margin: 40px;
    }
</style>

<div class="col-sm-10">
    <ol class="breadcrumb">
        <li class="active">商品管理</li>
        <li class="active">产品页面</li>
    </ol>

    <button id="addbtn">添加图片</button>
    <% if(list){%>
        <ul>
            <% for(let i =0; i<list.length;i++){ %>
                <% console.log(list[i].path)%>
                <li>
                    <img src="<%= list[i].path %>" width="500" alt="">
                </li>
            <% } %>
        </ul>
    <% }else {%>
    <% }%>

    

    <div id="mask">
        <div id="mask-content">
            <div class="panel panel-default">
                <div class="panel-heading">图片信息</div>
                <div class="panel-body">
                    <input type="text"  class="form-control" id="pageImgType" placeholder="输入图片分类">
                </div>
            </div>
            <label for="mask-pic" class="mask-upload">
                添加图片
            </label>
            <input type="file" name="pic" id="mask-pic">
            <img class="mask-picpng" src="/img/a.png" width="150" alt="上传图片">

            <button id="q">确定</button>

        </div>
    </div>
</div>


<script src="/y_mask/y_mask.js"></script>
<link rel="stylesheet" href="/y_mask/y_mask.css">
<script>
    new yMask('#addbtn','#mask',)

    //上传content 图片
        $(document).ready(function () {

            $('#q').click(function () {
                let file = document.getElementById('mask-pic');
                let formData = new FormData();
                formData.append('file',file.files[0]);
                $.ajax({
                    url:'pageProduct/addpic',
                    type:'POST',
                    data:formData,
                    async:true,
                    cache:false,
                    contentType:false,
                    processData:false,
                    success:function (data) {
                        if(data.code === 200){
                            console.log('img成功');
                            let upjson = {
                                "type":$('#pageImgType').val()
                            }
                            $.ajax({
                                url:'pageProduct/addtype',
                                type:'POST',
                                data:JSON.stringify(upjson),
                                async:true,
                                cache:false,
                                contentType:"application/json;charset=utf-8",
                                processData:false,
                                success:function (data){
                                    if(data.code === 200){
                                        console.log('type成功');
                                        console.log(data);
                                        window.history.go(0);
                                    }else{
                                        alert('上传失败')
                                    }
                                },
                                error:function (err){
                                    console.log('err',err);
                                }
                            })

                        }else{
                            alert('上传失败')
                        }

                    },
                    error:function (err){
                        console.log('err',err);
                    }
                })
            })
        })

    document.getElementById('mask-pic').onchange=function () {
        document.getElementById('q').style.display = 'block';
        document.getElementsByClassName('mask-picpng')[0].setAttribute('src',window.URL.createObjectURL(this.files[0]))
    }


</script>
</body>
</html>